import{_ as W,r as n,i as X,j as Y,k as Z,c as y,o as k,a,w as t,b as r,d as c,e as u,t as h,h as x,l as A,m as ee,n as ae,E as le}from"./index-CLxqDhjD.js";import{x as N}from"./xyaccount-CZzkGuBB.js";const te={class:"xyaccount-container"},oe={class:"card-header"},se={class:"pagination-container"},ne={class:"dialog-footer"},ue={class:"qr-container"},re=["src"],de={key:1,class:"scanning-tip"},ie={key:2,class:"success-tip"},pe={class:"dialog-footer"},ce={__name:"index",setup(me){const S=n([]),z=n(0),m=n(1),f=n(10),p=n(!1),_=n(!1),U=n(null),C=n(null),s=n({username:"",password:"",status:1}),B=X(()=>_.value?"编辑账号":"新增账号"),v=async()=>{try{const{data:o}=await N.find({page:m.value,pageSize:f.value});S.value=o.list,z.value=o.total}catch(o){console.error(o)}},I=o=>{_.value=!0,U.value=o.id,s.value={shopName:o.shopName,username:o.username,password:o.password,status:o.status},p.value=!0},M=()=>{_.value=!1,s.value={username:"",password:"",status:1},p.value=!0},R=async()=>{C.value&&await C.value.validate(async o=>{if(o)try{const e={shopName:s.value.shopName,username:s.value.username,password:s.value.password,status:s.value.status};if(_.value)await N.update(U.value,e),le.success("编辑成功"),p.value=!1;else{const{data:d}=await N.create(e)}v()}catch(e){console.error(e)}})},j=o=>{f.value=o,m.value=1,v()},L=o=>{m.value=o,v()};Y(()=>{v()});const b=n(!1),$=n("");n("");const q=n(!1),T=n(!1);let P=null;const F=()=>{clearInterval(P),b.value=!1,q.value=!1,T.value=!1,v()};return Z(()=>{}),(o,e)=>{const d=r("el-button"),i=r("el-table-column"),G=r("el-tag"),H=r("el-table"),J=r("el-pagination"),K=r("el-card"),V=r("el-input"),g=r("el-form-item"),O=r("el-switch"),Q=r("el-form"),D=r("el-dialog"),E=r("el-icon");return k(),y("div",te,[a(K,{class:"xyaccount-card"},{header:t(()=>[c("div",oe,[e[10]||(e[10]=c("span",null,"闲鱼账号管理",-1)),a(d,{type:"primary",onClick:M},{default:t(()=>e[9]||(e[9]=[u(" 新增账号 ")])),_:1})])]),default:t(()=>[a(H,{data:S.value,style:{width:"100%"}},{default:t(()=>[a(i,{prop:"shopName",label:"店铺名称"}),a(i,{prop:"username",label:"账号"}),a(i,{prop:"password",label:"密码"}),a(i,{prop:"productCount",label:"在售商品",width:"100"},{default:t(({row:l})=>[a(d,{link:"",type:"primary",onClick:w=>o.$router.push(`/xygood/${l.id}`)},{default:t(()=>e[11]||(e[11]=[u(" 查看 ")])),_:2},1032,["onClick"])]),_:1}),a(i,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[a(G,{type:l.status?"success":"info"},{default:t(()=>[u(h(l.status?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"createTime",label:"创建时间",width:"180"},{default:t(({row:l})=>[u(h(new Date(l.createTime).toLocaleString()),1)]),_:1}),a(i,{label:"操作",width:"250",fixed:"right"},{default:t(({row:l})=>[a(d,{type:"primary",link:"",onClick:w=>I(l)},{default:t(()=>e[12]||(e[12]=[u(" 编辑 ")])),_:2},1032,["onClick"]),a(d,{type:"success",link:"",onClick:w=>o.handleToggleStatus(l)},{default:t(()=>[u(h(l.status?"禁用":"启用"),1)]),_:2},1032,["onClick"]),a(d,{type:"danger",link:"",onClick:w=>o.handleDelete(l)},{default:t(()=>e[13]||(e[13]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),c("div",se,[a(J,{"current-page":m.value,"onUpdate:currentPage":e[0]||(e[0]=l=>m.value=l),"page-size":f.value,"onUpdate:pageSize":e[1]||(e[1]=l=>f.value=l),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next",onSizeChange:j,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1}),a(D,{title:B.value,modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=l=>p.value=l),width:"500px"},{footer:t(()=>[c("div",ne,[a(d,{onClick:e[6]||(e[6]=l=>p.value=!1)},{default:t(()=>e[14]||(e[14]=[u("取消")])),_:1}),a(d,{type:"primary",onClick:R},{default:t(()=>e[15]||(e[15]=[u("确定")])),_:1})])]),default:t(()=>[a(Q,{ref_key:"formRef",ref:C,model:s.value,rules:o.rules,"label-width":"100px"},{default:t(()=>[a(g,{label:"店铺名称",prop:"shopName",rules:[{required:!0,message:"请输入店铺名称",trigger:"blur"}]},{default:t(()=>[a(V,{modelValue:s.value.shopName,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.shopName=l),placeholder:"请输入店铺名称"},null,8,["modelValue"])]),_:1}),a(g,{label:"账号",prop:"username",rules:[{required:!0,message:"请输入账号",trigger:"blur"}]},{default:t(()=>[a(V,{modelValue:s.value.username,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.username=l),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),a(g,{label:"密码",prop:"password",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]},{default:t(()=>[a(V,{modelValue:s.value.password,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.password=l),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),a(g,{label:"状态"},{default:t(()=>[a(O,{modelValue:s.value.status,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.status=l),"active-value":1,"inactive-value":0,"inline-prompt":"","active-text":"正常","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),a(D,{title:"请扫码登录",modelValue:b.value,"onUpdate:modelValue":e[8]||(e[8]=l=>b.value=l),width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[c("span",pe,[a(d,{onClick:o.handleCancelScan},{default:t(()=>e[18]||(e[18]=[u("取消")])),_:1},8,["onClick"]),a(d,{type:"primary",onClick:F},{default:t(()=>e[19]||(e[19]=[u(" 确认已扫码 ")])),_:1})])]),default:t(()=>[c("div",ue,[$.value?(k(),y("img",{key:0,src:"data:image/png;base64,"+$.value},null,8,re)):x("",!0),q.value?(k(),y("div",de,[a(E,{class:"is-loading"},{default:t(()=>[a(A(ee))]),_:1}),e[16]||(e[16]=u(" 正在等待扫码... "))])):x("",!0),T.value?(k(),y("div",ie,[a(E,null,{default:t(()=>[a(A(ae))]),_:1}),e[17]||(e[17]=u(" 扫码成功！ "))])):x("",!0)])]),_:1},8,["modelValue"])])}}},_e=W(ce,[["__scopeId","data-v-ca44a592"]]);export{_e as default};
