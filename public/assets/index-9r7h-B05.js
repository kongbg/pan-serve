import{s as A}from"./search-LNl-_w1z.js";import{s as E}from"./source-bP-gSJ-q.js";import{_ as N,r,f as B,c as P,o as x,d as C,a as o,b as i,w as l,g as M,h as T,e as f,t as L,E as m}from"./index-CLxqDhjD.js";const j={class:"search-container"},D={class:"search-header"},F={class:"pagination-container"},G={__name:"index",setup($){const g=r("飞牛NAS"),c=r(1),d=r(10),_=r(0),v=r([]),h=r(!1),y=B(),b=e=>Array.isArray(e)?e.map(a=>a.text).join(""):e,V=async()=>{var e;h.value=!0;try{const a=await A.getList({page:c.value,pageSize:d.value,keyword:g.value});a.code==200?(v.value=(((e=a.data)==null?void 0:e.list)||[]).sort((s,p)=>p.want-s.want),_.value=a.data.total):m.error(a.message||"获取资源列表失败")}catch(a){console.error("获取资源列表失败:",a)}finally{h.value=!1,y.machineInfo.type=="count"&&await y.fetchMachineInfo()}},U=e=>{d.value=e},w=e=>{c.value=e},S=async e=>{if(e.added){m.warning("商品已加入资源库，请勿重复添加");return}let a={goodId:e.goodId,myGoodId:"",shopId:"",categoryId:e.categoryId,name:e.name,wantCot:e.wantCot,viewCot:0,picUrl:e.picUrl,urls:e.urls,isExtract:!1,status:1,delFlag:0,price:e.price,stock:0,shareUrl:"",no:"",description:e.description,autoPush:!1,createTime:"",publishedShops:[],sendTxt:""};(await E.create(a)).code==200?(e.added=!0,m.success("已成功加入资源库")):m.error("加入资源库失败")};return(e,a)=>{const s=i("el-input"),p=i("el-button"),n=i("el-table-column"),k=i("el-image"),z=i("el-table"),I=i("el-pagination");return x(),P("div",j,[C("div",D,[o(s,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=t=>g.value=t),placeholder:"请输入搜索引擎"},null,8,["modelValue"]),o(p,{type:"primary",onClick:V},{default:l(()=>a[3]||(a[3]=[f("搜索")])),_:1})]),o(z,{data:v.value,style:{width:"100%"},"default-sort":{prop:"want",order:"descending"}},{default:l(()=>[o(n,{prop:"name",label:"商品名称"},{default:l(({row:t})=>[o(s,{type:"textarea",rows:"8",modelValue:t.name,"onUpdate:modelValue":u=>t.name=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(n,{prop:"description",label:"商品描述"},{default:l(({row:t})=>[o(s,{type:"textarea",rows:"8",modelValue:t.description,"onUpdate:modelValue":u=>t.description=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(n,{prop:"picUrl",label:"图片"},{default:l(({row:t})=>[o(k,{style:{width:"100px",height:"100px"},"preview-teleported":"",src:t.picUrl,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.picUrl],"show-progress":"","initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])]),_:1}),o(n,{prop:"price",label:"价格"},{default:l(({row:t})=>[f(L(b(t.price)),1)]),_:1}),o(n,{prop:"wantCot",label:"想要人数",sortable:""}),o(n,{prop:"viewCot",label:"浏览量"}),o(n,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[o(p,{type:"primary",link:"",onClick:u=>S(t)},{default:l(()=>a[4]||(a[4]=[f(" 加入资源库 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),C("div",F,[_.value>0?(x(),M(I,{key:0,class:"pagination","current-page":c.value,"onUpdate:currentPage":a[1]||(a[1]=t=>c.value=t),"page-size":d.value,"onUpdate:pageSize":a[2]||(a[2]=t=>d.value=t),"page-sizes":[10,20,50,100],total:_.value,onSizeChange:U,onCurrentChange:w,layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])):T("",!0)])])}}},K=N(G,[["__scopeId","data-v-22aa9cd4"]]);export{K as default};
