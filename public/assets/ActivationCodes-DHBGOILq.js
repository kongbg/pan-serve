import{B as S,_ as j,r as f,j as O,c as C,o as w,d as _,x as P,a as t,w as l,b as n,y as R,g as F,E as m,e as c,t as u}from"./index-CLxqDhjD.js";class G extends S{constructor(){super("/activation")}}const A=new G,q={class:"activation-codes-container"},z={class:"page-header"},H={class:"actions"},J=["onClick"],Q={key:0},W={key:1},X=["onClick"],Y={class:"dialog-footer"},Z={__name:"ActivationCodes",setup(I){const b=f([]),g=f(!1),y=f(!1),h=f(!1),i=f({machineId:"",type:"monthly"}),U=a=>({count:"次卡",daily:"日卡",weekly:"周卡",monthly:"月卡",yearly:"年卡"})[a]||"未激活",k=a=>{navigator.clipboard.writeText(a),m.success("复制成功")},V=async()=>{try{g.value=!0;const a=await A.getAll();b.value=a.data||[]}catch(a){console.error("获取激活码失败:",a),m.error("获取激活码失败")}finally{g.value=!1}},$=()=>{y.value=!0,i.value={machineId:"",type:"monthly"}},B=async()=>{try{h.value=!0;const a=await A.create(i.value);a.code==200?(m.success("成功生成"),y.value=!1,V()):m.error(a.message||"生成激活码失败")}catch(a){console.error("生成激活码失败:",a),m.error("生成激活码失败")}finally{h.value=!1}},D=()=>{const a=b.value.filter(d=>!d.isUsed);if(a.length===0){m.warning("没有可导出的未使用激活码");return}let o=`Code,Type,ValidPeriod,CreatedAt
`;a.forEach(d=>{o+=`${d.code},${d.type},${d.validPeriod},${d.createdAt}
`});const p=new Blob([o],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(p),r=document.createElement("a");r.href=s,r.setAttribute("download",`activation-codes-${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r)};return O(()=>{V()}),(a,o)=>{const p=n("el-button"),s=n("el-table-column"),r=n("el-tag"),d=n("el-table"),T=n("el-input"),x=n("el-form-item"),v=n("el-option"),E=n("el-select"),L=n("el-form"),M=n("el-dialog"),N=R("loading");return w(),C("div",q,[_("div",z,[o[6]||(o[6]=_("h2",null,"激活码管理",-1)),_("div",H,[t(p,{type:"primary",onClick:$},{default:l(()=>o[4]||(o[4]=[c("生成激活码")])),_:1}),t(p,{type:"success",onClick:D},{default:l(()=>o[5]||(o[5]=[c("导出激活码")])),_:1})])]),P((w(),F(d,{data:b.value,border:"",style:{width:"100%"},"show-overflow-tooltip":""},{default:l(()=>[t(s,{prop:"licenseKey",label:"激活码",width:"200"},{default:l(e=>[_("div",{class:"code-container",onClick:K=>k(e.row.licenseKey)},u(e.row.licenseKey),9,J)]),_:1}),t(s,{prop:"type",label:"类型"},{default:l(e=>[t(r,{type:"primary"},{default:l(()=>[c(u(U(e.row.type)),1)]),_:2},1024)]),_:1}),t(s,{prop:"daysLeft",label:"有效期",width:"100"},{default:l(e=>[e.row.type==="count"?(w(),C("span",Q,u(e.row.count)+"次 ",1)):(w(),C("span",W,u(e.row.daysLeft)+"天 ",1))]),_:1}),t(s,{prop:"isUsed",label:"状态"},{default:l(e=>[t(r,{type:e.row.isUsed?"danger":"success"},{default:l(()=>[c(u(e.row.isUsed?"已使用":"未使用"),1)]),_:2},1032,["type"])]),_:1}),t(s,{prop:"machineId",label:"使用设备"},{default:l(e=>[_("div",{class:"code-container",onClick:K=>k(e.row.machineId)},u(e.row.machineId),9,X)]),_:1}),t(s,{prop:"createTime",label:"创建时间"},{default:l(e=>[c(u(e.row.createTime),1)]),_:1})]),_:1},8,["data"])),[[N,g.value]]),t(M,{modelValue:y.value,"onUpdate:modelValue":o[3]||(o[3]=e=>y.value=e),title:"生成激活码",width:"600px"},{footer:l(()=>[_("span",Y,[t(p,{onClick:o[2]||(o[2]=e=>y.value=!1)},{default:l(()=>o[7]||(o[7]=[c("取消")])),_:1}),t(p,{type:"primary",onClick:B,loading:h.value},{default:l(()=>o[8]||(o[8]=[c(" 生成 ")])),_:1},8,["loading"])])]),default:l(()=>[t(L,{model:i.value,"label-width":"100px"},{default:l(()=>[t(x,{label:"设备id"},{default:l(()=>[t(T,{type:"textarea",rows:5,modelValue:i.value.machineId,"onUpdate:modelValue":o[0]||(o[0]=e=>i.value.machineId=e)},null,8,["modelValue"])]),_:1}),t(x,{label:"类型"},{default:l(()=>[t(E,{modelValue:i.value.type,"onUpdate:modelValue":o[1]||(o[1]=e=>i.value.type=e),placeholder:"请选择类型"},{default:l(()=>[t(v,{label:"次卡",value:"count"}),t(v,{label:"日卡",value:"daily"}),t(v,{label:"周卡",value:"weekly"}),t(v,{label:"月卡",value:"monthly"}),t(v,{label:"年卡",value:"yearly"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},te=j(Z,[["__scopeId","data-v-9e9627ff"]]);export{te as default};
