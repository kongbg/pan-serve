var fe=Object.defineProperty;var be=(b,i,u)=>i in b?fe(b,i,{enumerable:!0,configurable:!0,writable:!0,value:u}):b[i]=u;var L=(b,i,u)=>be(b,typeof i!="symbol"?i+"":i,u);import{B as he,_ as Ve,r as s,i as ke,p as ye,j as xe,c as F,o as k,a as l,w as t,b as n,q as we,E as G,d as m,e as _,t as S,l as Ce,s as Ue,g as P,h as j,F as Se,v as Te}from"./index-CLxqDhjD.js";import{x as ze}from"./xyaccount-CZzkGuBB.js";import{s as Ae}from"./source-bP-gSJ-q.js";class Pe extends he{constructor(){super("/xygoods");L(this,"xysell",u=>this.customGet("xysell",u))}}const $e=new Pe,Ee={class:"good-container"},Ie={class:"card-header"},Be={class:"header-left"},Me=["src"],Ne={class:"pagination-container"},qe={class:"dialog-footer"},Re={class:"parse-dialog-content"},De={class:"parse-message"},Le={class:"dialog-footer"},Fe={class:"parse-dialog-content"},Ge={class:"parse-message"},je={__name:"index",setup(b){const i=we(),u=s(1),v=s(15),$=s(0),T=s([]),y=s(!1),E=s(!1),Y=s(null),H=s(null),J=s([]),d=s({shareUrl:"",sendTxt:"",name:"",no:"",price:0,stock:0,description:"",autoPush:!1,status:1,urls:[]}),K={shareUrl:[{required:!0,message:"请输入网盘地址",trigger:"blur"}]},O=ke(()=>E.value?"编辑商品":"新增商品"),I=s(!1),Q=s(0),W=s(""),X=s("正在解析商品信息..."),h=s("1"),Z=o=>{const e=ee(o);d.value.shareUrl="",e.forEach(p=>{d.value.shareUrl+=p.type+": "+p.link[0]+`
`}),d.value.sendTxt=`亲爱的 {用户名称} 会员您好
  您购买的商品已为您发货
  【发货内容】
  订单号：{订单编号}
  ${d.value.shareUrl}
  请您及时查收，记得好评哦！
  祝您购物愉快！`},ee=o=>{const e=/(https?:\/\/pan\.baidu\.com\/\S+?)\s+提取码:\s*(\w+)/g,p=/https:\/\/pan\.quark\.cn\/s\/\S+/g,r=Array.from(o.matchAll(e)).map(g=>({type:"佰渡网盘",link:g,extractCode:g})),c=Array.from(o.matchAll(p)).map(g=>({type:"跨克网盘",link:g}));return[...r,...c]},x=async()=>{var o,e,p;try{let r={page:u.value,pageSize:v.value,accountId:i.params.accountId};h.value==="available"&&(r.shareUrl="nonEmpty");const{data:c}=await $e.xysell(r);c.pagination={total:c.count,page:u.value,pageSize:v.value},T.value=c.list||[],T.value.map(g=>{g.is_show=g.is_show===1}),$.value=((o=c.pagination)==null?void 0:o.total)||0,u.value=((e=c.pagination)==null?void 0:e.page)||1,v.value=((p=c.pagination)==null?void 0:p.pageSize)||15}catch(r){console.error("获取商品列表失败:",r),G.error("获取商品列表失败")}};ye([u,v],()=>{console.log("分页变化",u.value,v.value),x()});const B=o=>{E.value=!0,Y.value=o.goodId,d.value={shareUrl:o.shareUrl,sendTxt:o.sendTxt,name:o.name,no:o.no,price:o.price,stock:o.stock,description:o.description,autoPush:o.autoPush,status:o.status,urls:o.urls||[]},J.value=(o.urls||[]).map((e,p)=>({name:`图片${p+1}`,url:e})),y.value=!0},le=async o=>{try{console.log("切换状态",o),o.is_show=o.is_show?0:1,await Ae.autoSend({goods_id:o.goods_id,accountId:i.params.accountId}),G.success("设置自动发货成功")}catch(e){console.error("设置自动发货失败:",e)}},ae=o=>{v.value=o,x()},oe=o=>{u.value=o},te=o=>{u.value=1,x()},z=s(!1),M=s(!1),se=s(0),ne=s(""),ue=s("正在上架商品..."),A=s([]);s(null);const N=s([]),de=async()=>{try{const{data:o}=await ze.find({page:u.value,pageSize:v.value});N.value=o.list}catch(o){console.error("获取店铺列表失败:",o)}};return xe(()=>{x(),de()}),(o,e)=>{const p=n("el-icon"),r=n("el-button"),c=n("el-tab-pane"),g=n("el-tabs"),f=n("el-table-column"),re=n("el-switch"),q=n("el-dropdown-item"),ie=n("el-dropdown-menu"),pe=n("el-dropdown"),ce=n("el-table"),me=n("el-pagination"),_e=n("el-card"),w=n("el-input"),V=n("el-form-item"),R=n("el-form"),C=n("el-dialog"),D=n("el-progress"),ve=n("el-checkbox"),ge=n("el-checkbox-group");return k(),F("div",Ee,[l(_e,{class:"good-card"},{header:t(()=>[m("div",Ie,[m("div",Be,[l(r,{link:"",onClick:e[0]||(e[0]=a=>o.$router.back())},{default:t(()=>[l(p,null,{default:t(()=>[l(Ce(Ue))]),_:1}),e[15]||(e[15]=_(" 返回店铺列表 "))]),_:1})])])]),default:t(()=>[l(g,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),onTabChange:te},{default:t(()=>[l(c,{label:"出售中的商品",name:"1"})]),_:1},8,["modelValue"]),l(ce,{data:T.value,style:{width:"100%"}},{default:t(()=>[l(f,{prop:"store_name",label:"商品名称"}),l(f,{prop:"picUrl",label:"图片",width:"100"},{default:t(({row:a})=>[m("img",{src:a.picUrl,alt:"商品图片",style:{width:"100%",height:"100%"}},null,8,Me)]),_:1}),l(f,{prop:"price",label:"价格",width:"100"},{default:t(({row:a})=>[_(" ¥"+S(a.price),1)]),_:1}),l(f,{prop:"exposureNum",label:"曝光量",width:"100"}),l(f,{prop:"wantNum",label:"想要人数",width:"100",sortable:""}),l(f,{prop:"browseCount",label:"浏览量",width:"100"}),l(f,{prop:"is_show",label:"自动发货状态",width:"100"},{default:t(({row:a})=>[l(re,{modelValue:a.is_show,"onUpdate:modelValue":U=>a.is_show=U,onChange:U=>le(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(f,{label:"操作",width:"200",fixed:"right"},{default:t(({row:a})=>[l(pe,null,{dropdown:t(()=>[l(ie,null,{default:t(()=>[l(q,{onClick:U=>B(a)},{default:t(()=>e[17]||(e[17]=[_("配置发货")])),_:2},1032,["onClick"]),l(q,{onClick:U=>B(a)},{default:t(()=>e[18]||(e[18]=[_("编辑商品")])),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[l(r,{type:"primary",link:""},{default:t(()=>e[16]||(e[16]=[_(" 更多 ")])),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"]),m("div",Ne,[l(me,{"current-page":u.value,"onUpdate:currentPage":e[2]||(e[2]=a=>u.value=a),"page-size":v.value,"onUpdate:pageSize":e[3]||(e[3]=a=>v.value=a),"page-sizes":[15],total:$.value,layout:"total, sizes, prev, pager, next",onSizeChange:ae,onCurrentChange:oe},null,8,["current-page","page-size","total"])])]),_:1}),l(C,{title:O.value,modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=a=>y.value=a),width:"50%"},{footer:t(()=>[m("span",qe,[l(r,{onClick:e[8]||(e[8]=a=>y.value=!1)},{default:t(()=>e[19]||(e[19]=[_("取消")])),_:1}),l(r,{type:"primary",onClick:o.handleSubmit},{default:t(()=>e[20]||(e[20]=[_(" 确定 ")])),_:1},8,["onClick"])])]),default:t(()=>[l(R,{ref_key:"formRef",ref:H,model:d.value,rules:K,"label-width":"100px"},{default:t(()=>[l(V,{label:"商品编号",prop:"no"},{default:t(()=>[l(w,{modelValue:d.value.no,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.no=a),placeholder:"请输入商品编号"},null,8,["modelValue"])]),_:1}),h.value==="available"?(k(),P(V,{key:0,label:"商品描述",prop:"description"},{default:t(()=>[l(w,{modelValue:d.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.description=a),"show-word-limit":"",type:"textarea",rows:"5",placeholder:"请输入商品描述"},null,8,["modelValue"])]),_:1})):j("",!0),l(V,{label:"网盘地址",prop:"shareUrl"},{default:t(()=>[l(w,{modelValue:d.value.shareUrl,"onUpdate:modelValue":e[6]||(e[6]=a=>d.value.shareUrl=a),type:"textarea",rows:"5",placeholder:"请输入网盘地址",onChange:Z},null,8,["modelValue"])]),_:1}),h.value==="available"?(k(),P(V,{key:1,label:"自动发货文案",prop:"sendTxt"},{default:t(()=>[l(w,{modelValue:d.value.sendTxt,"onUpdate:modelValue":e[7]||(e[7]=a=>d.value.sendTxt=a),type:"textarea",rows:"5",placeholder:"请输入自动发货文案"},null,8,["modelValue"])]),_:1})):j("",!0)]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(C,{title:"商品信息解析",modelValue:I.value,"onUpdate:modelValue":e[10]||(e[10]=a=>I.value=a),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"400px"},{default:t(()=>[m("div",Re,[l(D,{type:"circle",percentage:Q.value,status:W.value},null,8,["percentage","status"]),m("div",De,S(X.value),1)])]),_:1},8,["modelValue"]),l(C,{title:"选择上架账号",modelValue:z.value,"onUpdate:modelValue":e[13]||(e[13]=a=>z.value=a),width:"30%"},{footer:t(()=>[m("span",Le,[l(r,{onClick:e[12]||(e[12]=a=>z.value=!1)},{default:t(()=>e[21]||(e[21]=[_("取消")])),_:1}),l(r,{type:"primary",disabled:!A.value.length,onClick:o.confirmPublish},{default:t(()=>e[22]||(e[22]=[_(" 确认上架 ")])),_:1},8,["disabled","onClick"])])]),default:t(()=>[l(R,null,{default:t(()=>[l(V,{label:"选择账号"},{default:t(()=>[l(ge,{modelValue:A.value,"onUpdate:modelValue":e[11]||(e[11]=a=>A.value=a)},{default:t(()=>[(k(!0),F(Se,null,Te(N.value,a=>(k(),P(ve,{key:a.id,label:a.id},{default:t(()=>[_(S(a.username),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(C,{title:"商品上架中",modelValue:M.value,"onUpdate:modelValue":e[14]||(e[14]=a=>M.value=a),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"400px"},{default:t(()=>[m("div",Fe,[l(D,{type:"circle",percentage:se.value,status:ne.value},null,8,["percentage","status"]),m("div",Ge,S(ue.value),1)])]),_:1},8,["modelValue"])])}}},Oe=Ve(je,[["__scopeId","data-v-d008fb76"]]);export{Oe as default};
