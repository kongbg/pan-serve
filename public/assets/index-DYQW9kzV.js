import{s as E}from"./search-LNl-_w1z.js";import{s as P}from"./source-bP-gSJ-q.js";import{g as A}from"./index-BBS3u-2N.js";import{_ as B,r as i,f as N,c as M,o as b,d as w,a as o,b as c,w as s,g as T,h as O,e as h,t as j,E as d}from"./index-CLxqDhjD.js";const D={class:"search-container"},F={class:"search-header"},G={class:"pagination-container"},L={__name:"index",setup(W){const p=i("https://www.goofish.com/item?spm=a21ybx.personal.feeds.1.7f596ac2rzPObC&id=765463908556&categoryId=50023914"),m=i(1),g=i(10),f=i(0),v=i([]),y=i(!1),x=N(),C=e=>Array.isArray(e)?e.map(t=>t.text).join(""):e,U=async()=>{var t,n;if(p.value.indexOf("goofish.com")==-1){d.error("请输入正确的商品链接");return}let e=A(p.value);if(!e.id||!e.categoryId){d.error("请输入正确的商品链接");return}y.value=!0;try{const l=await E.extract({url:p.value});l.code==200?(v.value=(((t=l.data)==null?void 0:t.list)||[]).sort((r,_)=>_.want-r.want),f.value=((n=l.data)==null?void 0:n.total)||0):d.error(l.message||"获取资源列表失败")}catch(l){console.error("获取资源列表失败:",l)}finally{y.value=!1,x.machineInfo.type=="count"&&await x.fetchMachineInfo()}},V=e=>{g.value=e},I=e=>{m.value=e},z=async e=>{if(e.added){d.warning("商品已加入资源库，请勿重复添加");return}let t={goodId:"",myGoodId:e.goodId,shopId:"",categoryId:"",name:e.title,wantCot:e.want,viewCot:0,picUrl:e.picUrl,urls:[e.picUrl],isExtract:!1,status:1,delFlag:0,price:e.price,stock:0,shareUrl:"",no:"",description:e.description,autoPush:!1,createTime:"",publishedShops:[],sendTxt:""};(await P.create(t)).code==200?(e.added=!0,d.success("已成功加入资源库")):d.error("加入资源库失败")};return(e,t)=>{const n=c("el-input"),l=c("el-button"),r=c("el-table-column"),_=c("el-image"),k=c("el-table"),S=c("el-pagination");return b(),M("div",D,[w("div",F,[o(n,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),placeholder:"请输入商品链接：https://www.goofish.com/item?spm=a21ybx.home.feedsCnxh.1.2a343da6We8Ep9&id=123&categoryId=123"},null,8,["modelValue"]),o(l,{type:"primary",onClick:U},{default:s(()=>t[3]||(t[3]=[h("提取")])),_:1})]),o(k,{data:v.value,style:{width:"100%"},"default-sort":{prop:"want",order:"descending"}},{default:s(()=>[o(r,{prop:"name",label:"商品名称"},{default:s(({row:a})=>[o(n,{type:"textarea",rows:"8",modelValue:a.name,"onUpdate:modelValue":u=>a.name=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(r,{prop:"description",label:"商品描述"},{default:s(({row:a})=>[o(n,{type:"textarea",rows:"8",modelValue:a.description,"onUpdate:modelValue":u=>a.description=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(r,{prop:"picUrl",label:"图片"},{default:s(({row:a})=>[o(_,{style:{width:"100px",height:"100px"},"preview-teleported":"",src:a.picUrl,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[a.picUrl],"show-progress":"","initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])]),_:1}),o(r,{prop:"price",label:"价格"},{default:s(({row:a})=>[h(j(C(a.price)),1)]),_:1}),o(r,{prop:"wantCot",label:"想要人数",sortable:""}),o(r,{prop:"viewCot",label:"浏览量"}),o(r,{label:"操作",width:"200",fixed:"right"},{default:s(({row:a})=>[o(l,{type:"primary",link:"",onClick:u=>z(a)},{default:s(()=>t[4]||(t[4]=[h(" 加入资源库 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),w("div",G,[f.value>0?(b(),T(S,{key:0,class:"pagination","current-page":m.value,"onUpdate:currentPage":t[1]||(t[1]=a=>m.value=a),"page-size":g.value,"onUpdate:pageSize":t[2]||(t[2]=a=>g.value=a),"page-sizes":[10,20,50,100],total:f.value,onSizeChange:V,onCurrentChange:I,layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])):O("",!0)])])}}},K=B(L,[["__scopeId","data-v-79a3aec0"]]);export{K as default};
