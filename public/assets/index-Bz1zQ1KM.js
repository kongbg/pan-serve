import{x as re}from"./xyaccount-CZzkGuBB.js";import{s as k}from"./source-bP-gSJ-q.js";import{_ as ne,r,j as ue,c as D,o as m,a,g as U,h as T,w as t,b as u,e as p,t as b,d as w,F as ie,v as de,E as j}from"./index-CLxqDhjD.js";const pe={class:"source-container"},ce={class:"dialog-footer"},me={class:"dialog-footer"},ge={class:"parse-dialog-content",style:{"text-align":"center"}},ve={class:"parse-message"},fe={__name:"index",setup(be){const N=r(!1),E=r([]),C=r(0),h=r(1),_=r(10),g=r(!1),S=r("add"),s=r({name:"",shareUrl:"",price:0,no:"",description:""}),z=r(null),F={name:[{required:!0,message:"请输入资源名称",trigger:"blur"},{max:30,message:"资源名称不能超过30个字符",trigger:"blur"}],shareUrl:[{required:!0,message:"请输入资源链接",trigger:"blur"},{max:500,message:"资源链接不能超过500个字符",trigger:"blur"}],sendTxt:[{required:!0,message:"请输入自动发货内容",trigger:"blur"},{max:260,message:"自动发货内容不能超过260个字符",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],description:[{required:!0,message:"请输入商品描述",trigger:"blur"},{max:500,message:"商品描述不能超过500个字符",trigger:"blur"}]};let L=r([]);const Y=(o=[])=>{let e=[];return o.forEach(n=>{let d=L.value.find(f=>f.id===n);d&&e.push(d.shopName)}),e.join(`
`)},y=async()=>{N.value=!0;try{const o=await k.find({page:h.value,pageSize:_.value});E.value=o.data.list,C.value=o.data.total}catch(o){console.error("获取资源列表失败:",o)}finally{N.value=!1}},H=o=>{S.value="edit",s.value={...o},g.value=!0},J=async()=>{if(z.value){await z.value.validate();try{S.value==="add"?(await k.create(s.value),j.success("添加成功")):(await k.update(s.value.id,s.value),j.success("更新成功")),g.value=!1,y()}catch(o){console.error("提交失败:",o)}}},M=()=>{const o=K(s.value.shareUrl);s.value.shareUrl="",o.forEach(e=>{s.value.shareUrl+=e.type+": "+e.link[0]+`
`}),s.value.sendTxt=`亲爱的 {用户名称} 会员您好
  您购买的商品已为您发货
  【发货内容】
  订单号：{订单编号}
  ${s.value.shareUrl}
  请您及时查收，记得好评哦！
  祝您购物愉快！`},K=o=>{const e=/(https?:\/\/pan\.baidu\.com\/\S+?)\s+提取码:\s*(\w+)/g,n=/https:\/\/pan\.quark\.cn\/s\/\S+/g,d=Array.from(o.matchAll(e)).map(i=>({type:"佰渡网盘",link:i,extractCode:i})),f=Array.from(o.matchAll(n)).map(i=>({type:"跨克网盘",link:i}));return[...d,...f]},O=o=>{_.value=o,y()},Q=o=>{h.value=o,y()},x=r(!1),P=r(!1),V=r(0),$=r(""),B=r("正在上架商品..."),v=r([]),G=r(null),I=r([]),W=o=>{G.value=o,v.value=[],x.value=!0},X=async()=>{P.value=!0,V.value=0,$.value="",B.value="正在上架商品...",setInterval(()=>{V.value<90&&(V.value+=10)},200);try{console.log("pushGood1"),await k.pushGood({goodIds:[G.value.id],accountIds:v.value}),console.log("pushGood2")}catch(o){console.error("更新失败:",o)}},Z=async()=>{try{const{data:o}=await re.find({page:1,pageSize:20});I.value=o.list,L.value=o.list}catch(o){console.error("获取店铺列表失败:",o)}};return ue(async()=>{await Z(),y()}),(o,e)=>{const n=u("el-table-column"),d=u("el-input"),f=u("el-image"),i=u("el-button"),ee=u("el-table"),le=u("el-pagination"),c=u("el-form-item"),ae=u("el-input-number"),R=u("el-form"),q=u("el-dialog"),te=u("el-checkbox"),oe=u("el-checkbox-group"),se=u("el-progress");return m(),D("div",pe,[a(ee,{data:E.value,style:{width:"100%"}},{default:t(()=>[a(n,{prop:"name",label:"商品名称"}),a(n,{prop:"description",label:"商品描述(500字以内)"},{default:t(({row:l})=>[a(d,{type:"textarea",rows:"4",modelValue:l.description,"onUpdate:modelValue":A=>l.description=A},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(n,{prop:"picUrl",label:"图片",width:"100"},{default:t(({row:l})=>[a(f,{style:{width:"100px",height:"100px"},"preview-teleported":"",src:l.picUrl,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[l.picUrl],"show-progress":"","initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])]),_:1}),a(n,{prop:"price",label:"价格",width:"100"},{default:t(({row:l})=>[p(" ¥"+b(l.price),1)]),_:1}),a(n,{prop:"wantCot",label:"想要人数",width:"100",sortable:""}),a(n,{prop:"viewCot",label:"浏览量",width:"100"}),a(n,{prop:"shareUrl",label:"资源",width:"100"},{default:t(({row:l})=>[p(b(l.shareUrl?"已获取":"未获取"),1)]),_:1}),a(n,{prop:"publishedShops",label:"已上架店铺",width:"120"},{default:t(({row:l})=>[p(b(Y(l.publishedShops)),1)]),_:1}),a(n,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[a(i,{type:"primary",link:"",onClick:A=>H(l)},{default:t(()=>e[14]||(e[14]=[p(" 编辑 ")])),_:2},1032,["onClick"]),l.description.length<=500&&l.shareUrl&&l.sendTxt?(m(),U(i,{key:0,type:"success",link:"",onClick:A=>W(l)},{default:t(()=>e[15]||(e[15]=[p(" 上架 ")])),_:2},1032,["onClick"])):T("",!0)]),_:1})]),_:1},8,["data"]),C.value>0?(m(),U(le,{key:0,class:"pagination","current-page":h.value,"onUpdate:currentPage":e[0]||(e[0]=l=>h.value=l),"page-size":_.value,"onUpdate:pageSize":e[1]||(e[1]=l=>_.value=l),"page-sizes":[10,20,50,100],total:C.value,onSizeChange:O,onCurrentChange:Q,layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])):T("",!0),a(q,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=l=>g.value=l),title:S.value==="add"?"新增资源":"编辑资源",width:"50%"},{footer:t(()=>[w("span",ce,[a(i,{onClick:e[8]||(e[8]=l=>g.value=!1)},{default:t(()=>e[17]||(e[17]=[p("取消")])),_:1}),a(i,{type:"primary",onClick:J},{default:t(()=>e[18]||(e[18]=[p("确定")])),_:1})])]),default:t(()=>[a(R,{ref_key:"formRef",ref:z,model:s.value,rules:F,"label-width":"120px"},{default:t(()=>[a(c,{label:"资源名称",prop:"name"},{default:t(()=>[a(d,{modelValue:s.value.name,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.name=l),placeholder:"请输入资源名称"},null,8,["modelValue"])]),_:1}),a(c,{label:"资源链接",prop:"shareUrl"},{default:t(()=>[a(d,{type:"textarea",modelValue:s.value.shareUrl,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.shareUrl=l),rows:3,placeholder:"请输入资源链接",onChange:M},null,8,["modelValue"])]),_:1}),a(c,{label:"自动发货内容",prop:"sendTxt"},{default:t(()=>[s.value.shareUrl?(m(),U(i,{key:0,type:"primary",onClick:M,style:{"margin-bottom":"10px"}},{default:t(()=>e[16]||(e[16]=[p("自动生成")])),_:1})):T("",!0),a(d,{type:"textarea",modelValue:s.value.sendTxt,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.sendTxt=l),rows:5,placeholder:"请输入自动发货内容"},null,8,["modelValue"])]),_:1}),a(c,{label:"价格",prop:"price"},{default:t(()=>[a(ae,{modelValue:s.value.price,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.price=l),min:0,precision:2},null,8,["modelValue"])]),_:1}),a(c,{label:"编号",prop:"no"},{default:t(()=>[a(d,{modelValue:s.value.no,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.no=l),placeholder:"请输入编号"},null,8,["modelValue"])]),_:1}),a(c,{label:"描述",prop:"description"},{default:t(()=>[a(d,{type:"textarea",modelValue:s.value.description,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.description=l),rows:4,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(q,{title:"选择上架账号",modelValue:x.value,"onUpdate:modelValue":e[12]||(e[12]=l=>x.value=l),width:"30%"},{footer:t(()=>[w("span",me,[a(i,{onClick:e[11]||(e[11]=l=>x.value=!1)},{default:t(()=>e[19]||(e[19]=[p("取消")])),_:1}),a(i,{type:"primary",disabled:!v.value.length,onClick:X},{default:t(()=>e[20]||(e[20]=[p(" 确认上架 ")])),_:1},8,["disabled"])])]),default:t(()=>[a(R,null,{default:t(()=>[a(c,{label:"选择账号"},{default:t(()=>[a(oe,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value=l)},{default:t(()=>[(m(!0),D(ie,null,de(I.value,l=>(m(),U(te,{key:l.id,label:l.id},{default:t(()=>[p(b(l.shopName||l.username),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(q,{title:"商品上架中",modelValue:P.value,"onUpdate:modelValue":e[13]||(e[13]=l=>P.value=l),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"400px"},{default:t(()=>[w("div",ge,[a(se,{type:"circle",percentage:V.value,status:$.value},null,8,["percentage","status"]),w("div",ve,b(B.value),1)])]),_:1},8,["modelValue"])])}}},xe=ne(fe,[["__scopeId","data-v-afeea911"]]);export{xe as default};
