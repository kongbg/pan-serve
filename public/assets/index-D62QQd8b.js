var U=Object.defineProperty;var q=(l,r,e)=>r in l?U(l,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[r]=e;var p=(l,r,e)=>q(l,typeof r!="symbol"?r+"":r,e);import{B as A,_ as E,r as g,c as I,o as N,a as t,w as o,b as m,u as R,d as _,e as V,t as h,E as f}from"./index-CLxqDhjD.js";class M extends A{constructor(){super("/users");p(this,"getCaptcha",()=>(console.log("自定义方法-获取验证码"),this.customGet("captcha")));p(this,"login",e=>this.customPost("login",e));p(this,"register",e=>this.customPost("register",e))}}const b=new M,P={class:"login-container"},D={class:"card-header"},G={class:"captcha-container"},L=["src"],T={__name:"index",setup(l){const r=R(),e=g(!0),v=g(null),w=g(""),a=g({username:"",password:"",captcha:""}),y={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:4,message:"验证码长度为 4 位",trigger:"blur"}]},c=async()=>{console.log("refreshCaptcha:",b);try{const{data:u}=await b.getCaptcha();w.value=`data:image/svg+xml;base64,${btoa(u.image)}`}catch(u){console.error("获取验证码失败:",u)}},k=()=>{e.value=!e.value,a.value={username:"",password:"",captcha:""},c()},C=async()=>{v.value&&await v.value.validate(async u=>{if(u)try{const{code:s,data:i,message:n}=await b[e.value?"login":"register"](a.value);e.value?s==200?(localStorage.setItem("token",i.token),localStorage.setItem("username",a.value.username),f.success("登录成功"),r.push("/")):f.error(n):s==200?(f.success("注册成功"),e.value=!0):f.error(n),a.value.captcha="",c()}catch(s){console.error(s),c()}})};return c(),(u,s)=>{const i=m("el-input"),n=m("el-form-item"),x=m("el-button"),B=m("el-form"),S=m("el-card");return N(),I("div",P,[t(S,{class:"login-card"},{header:o(()=>[_("div",D,[_("span",null,h(e.value?"登录":"注册"),1)])]),default:o(()=>[t(B,{ref_key:"formRef",ref:v,model:a.value,rules:y,"label-width":"80px"},{default:o(()=>[t(n,{label:"用户名",prop:"username"},{default:o(()=>[t(i,{modelValue:a.value.username,"onUpdate:modelValue":s[0]||(s[0]=d=>a.value.username=d)},null,8,["modelValue"])]),_:1}),t(n,{label:"密码",prop:"password"},{default:o(()=>[t(i,{modelValue:a.value.password,"onUpdate:modelValue":s[1]||(s[1]=d=>a.value.password=d),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),t(n,{label:"验证码",prop:"captcha"},{default:o(()=>[_("div",G,[t(i,{modelValue:a.value.captcha,"onUpdate:modelValue":s[2]||(s[2]=d=>a.value.captcha=d)},null,8,["modelValue"]),_("img",{src:w.value,class:"captcha-image",onClick:c,alt:"验证码"},null,8,L)])]),_:1}),t(n,null,{default:o(()=>[t(x,{type:"primary",onClick:C},{default:o(()=>[V(h(e.value?"登录":"注册"),1)]),_:1}),t(x,{link:"",onClick:k},{default:o(()=>[V(h(e.value?"没有账号？去注册":"已有账号？去登录"),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},z=E(T,[["__scopeId","data-v-4dbca377"]]);export{z as default};
