import{s as N}from"./search-LNl-_w1z.js";import{s as P}from"./source-bP-gSJ-q.js";import{g as E}from"./index-BBS3u-2N.js";import{_ as A,r as n,c as B,o as x,d as y,a as o,b as p,w as s,g as T,h as G,e as _,t as H,E as i}from"./index-CLxqDhjD.js";const O={class:"search-container"},j={class:"search-header"},D={class:"pagination-container"},F={__name:"index",setup(J){const c=n("https://www.goofish.com/personal?spm=a21ybx.item.itemHeader.1.35dc3da6uNPc4s&userId=1115350968"),m=n(1),g=n(9999),f=n(0),v=n([]),h=n(!1),b=n(JSON.parse(localStorage.getItem("machineInfo"))),C=e=>Array.isArray(e)?e.map(t=>t.text).join(""):e,w=async()=>{var t;if(b.value.type=="count"){i.warning("次卡用户不能使用店铺搬运功能，请联系客服充值月卡");return}if(c.value.indexOf("goofish.com")==-1){i.error("请输入正确的店铺链接");return}let e=E(c.value);if(console.log(e),!e.userId){i.error("请输入正确的店铺链接");return}h.value=!0;try{const l=await N.extractShop({url:c.value});l.code==200?(v.value=(((t=l.data)==null?void 0:t.list)||[]).sort((d,r)=>Number(r.wantCot)-Number(d.wantCot)),f.value=l.data.total):i.error(l.message)}catch(l){console.error("获取资源列表失败:",l)}finally{h.value=!1}},U=e=>{g.value=e},V=e=>{m.value=e},I=async e=>{if(e.added){i.warning("商品已加入资源库，请勿重复添加");return}let t={goodId:"",myGoodId:e.goodId,shopId:"",categoryId:"",name:e.title,wantCot:e.want,viewCot:0,picUrl:e.picUrl,urls:[e.picUrl],isExtract:!1,status:1,delFlag:0,price:e.price,stock:0,shareUrl:"",no:"",description:e.description,autoPush:!1,createTime:"",publishedShops:[],sendTxt:""};(await P.create(t)).code==200?(e.added=!0,i.success("已成功加入资源库")):i.error("加入资源库失败")};return(e,t)=>{const l=p("el-input"),d=p("el-button"),r=p("el-table-column"),S=p("el-image"),k=p("el-table"),z=p("el-pagination");return x(),B("div",O,[y("div",j,[o(l,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=a=>c.value=a),placeholder:"请输入店铺链接：https://www.goofish.com/personal?spm=a21ybx.item.itemHeader.1.7db23da6ix2aGa&userId=123"},null,8,["modelValue"]),o(d,{type:"primary",onClick:w},{default:s(()=>t[3]||(t[3]=[_("搜索")])),_:1})]),o(k,{data:v.value,style:{width:"100%"}},{default:s(()=>[o(r,{prop:"name",label:"商品名称"},{default:s(({row:a})=>[o(l,{type:"textarea",rows:"8",modelValue:a.name,"onUpdate:modelValue":u=>a.name=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(r,{prop:"description",label:"商品描述"},{default:s(({row:a})=>[o(l,{type:"textarea",rows:"8",modelValue:a.description,"onUpdate:modelValue":u=>a.description=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(r,{prop:"picUrl",label:"图片"},{default:s(({row:a})=>[o(S,{style:{width:"100px",height:"100px"},"preview-teleported":"",src:a.picUrl,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[a.picUrl],"show-progress":"","initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])]),_:1}),o(r,{prop:"price",label:"价格"},{default:s(({row:a})=>[_(H(C(a.price)),1)]),_:1}),o(r,{prop:"wantCot",label:"想要人数"}),o(r,{prop:"viewCot",label:"浏览量"}),o(r,{label:"操作",width:"200",fixed:"right"},{default:s(({row:a})=>[o(d,{type:"primary",link:"",onClick:u=>I(a)},{default:s(()=>t[4]||(t[4]=[_(" 加入资源库 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),y("div",D,[f.value>0?(x(),T(z,{key:0,class:"pagination","current-page":m.value,"onUpdate:currentPage":t[1]||(t[1]=a=>m.value=a),"page-size":g.value,"onUpdate:pageSize":t[2]||(t[2]=a=>g.value=a),"page-sizes":[10,20,50,100],total:f.value,onSizeChange:U,onCurrentChange:V,layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])):G("",!0)])])}}},K=A(F,[["__scopeId","data-v-7ad747f9"]]);export{K as default};
